#!/usr/bin/Rscript

library(ggplot2)
library(dada2)
#library(MultiAmplicon, lib.loc="/usr/local/lib/R/site-library/")
library(reshape)
library(phyloseq)
#remotes::install_github("vmikk/metagMisc")
library(metagMisc)
require(grid)
require(grid_extra)
require(cowplot)
library(microbiome)
library(DESeq2)
## using the devel
#devtools::load_all("/SAN/Susanas_den/MultiAmplicon/")

source("bin/PlottingCor.R")
# Filtering

PSfil <- filter(PS=PS, abund=0.00001, prev=0.01, reads=500)

PSwangfil <- filter(PS=PSwang, abund=0.00001, prev=0.01, reads=500)


names(sam_data(PS))
names(sam_data(PSwang))

plot_ordination(PSwang, ordinate(PSwang, "MDS"), color=


    sd <- sam_data(PS)


    sam$Strain <- as.factor(sam$Strain)

    summary(sam$)

sam
    
#df <- data.frame(sample_sums(otu_table(PS)))

library("fantaxtic")

top <- get_top_taxa(PSfil, 10, relative=TRUE, discard_other=FALSE, other_label="Other")
ps_tmp <- name_taxa(top, label="Unknown", species = T, other_label="Other")
all <- fantaxtic_bar(ps_tmp, color_by="phylum", label_by="family", other_label="Other")

all

top <- get_top_taxa(PSwangfil, 10, relative=TRUE, discard_other=FALSE, other_label="Other")
ps_tmp <- name_taxa(top, label="Unknown", species = T, other_label="Other")
wang <- fantaxtic_bar(ps_tmp, color_by="family", label_by="genus", other_label="Other")

png(filename="fig/abundance_all.png",
    width =7, height = 5, units = "in", res= 300)
all
dev.off()
png(filename="fig/abundance_wang.png",
    width =7, height = 5, units = "in", res= 300)
wang
dev.off()

